1장.
--학습 목표 : 공간정보 기반 공간 분석에 필요한 기본 통계기법 학습
	     지구통계학적 크리깅, 기계학습 알고리즘 고찰
	     강의와 SAGA GIS를 이용한 실습을 병행

  1. 공간정보 특성 분석
	속성정보, 위치 정보, 속성 + 위치 정보
  2. 주제도 작성
	신뢰도 높은 주제도 작성
	공간 특성 반영
  3. 응용
	탐색적 자료분석 -> 자료요약의 수정/확정을 통한 공간 패턴 분석 -> 공가패턴을 공간예측에 반영해 주제도 생성

--이론 강의
  1. 기술 통계 : 탐색적 자료 분석
  2. 지구통계학 :  공간패턴 모델링 & 크리깅
  3. 기계학습 : Regression/Classification

--스케쥴 순서
1. 탐색적 자료 분석 : 자료 형태, 자료 형태별 자료 요약 기법
2. 공간패턴 분석1 : Scattergram, covariance, correlation
3. 공간패턴 분석2 : variogram 분석 및 모델링
4. 공간예측 : 일반적인 공간 내삽 기법
5. 크리깅 : Simple kriging & Ordinary kriging
6. 기계학습1 : 기술동향 & 활용분야
7. 기계학습2 : 기계학습 알고리즘(회귀분석, 분류 등)

--공간정보공학에서 통계학의 역할
  -> what is where problem을 해결해야함
  -> 원하는 자료 획득 필수
	-> 원하는 시기와 지점에서의 자료 획득이 항상 가능한가?
	-> 제한적 자료만 이용할 수 있다면? -> 레스터 주제도 생성 ->크리깅으로
	-> 방대한 자료를 어떻게 이용할 것인가?
  -> 자료생성 및 분석 방법론 -> 분석시 공간적 위치 고려
  -> sample data to thematic map(공간패턴모델링과 공간예측을 통해)
  -> 공간통계는 지구과학의 통계가 아니라 지역변수에 대한 이론임

--공간통계란?
  공간통계 데이터
	-> 랜덤 연속공간적 프로세스를 통해 모델링이 가능
	-> 시공간의 보간과 산포도를 모델링할 수 있음

  공간패턴정의
	샘플 데이터 분포도에 지배적인 공간패턴이 있는가?
	공간패턴이 있다면 어떻게 설명할 수 있는가?
	ex) 어떤 물리적 또는 다른 요소로 중금속으로 인한 오염을 설명할수 있을까?

  불확실성에 대한 모델링
	샘플이 없는 지역에서 한계값을 넘을 확률은 무엇인가

  공간패턴 모델링
	EDA
	공간적이지 않는 특성 : 평균, 표준편차, Scatterplot, Covarinace, Correlation
	공간 패턴 분석 : h-scatterplot, variogram(공간의 분산을 분석)
	

    공간예측
	샘플이 없는 지점의 값은 무엇인가?
	ex) 샘플이 없는 지역의 중금속 농축도는 무엇인가?
	Kriging : least-square(최소제곱법)을 통한 보간법

--기계학습 
  기계학습이란 "컴퓨터에 명시적으로 프로그래밍 하지 않고 학습 할 수 있는 능력을 부여하는 것" 컴퓨터 과학의 하위 분야

  기계학습이 하는 일
	Classification 분류
	Clustering 군집화
	Regression 회귀분석

2장. EDA
Exploratory Data Analysis(탐색적 자료 분석)
	-통계 : 형식적인 통계 모델링 또는형식적인 가설모델
	-EDA : 핵심 특성을 요약하는 데이터 분석 방법, 가끔은 시각적방법도 사용
		-> 기술적인 통계방법

자료 종류
	-연속적 데이터[양적자료(qualitative)
		Interval 구간
			->절대적 원점 없음 
			-> 온도가 0도라 해서 온도가 없다라고 못함
		Ratio 비율
			-> 절대적 원점 존재
			-> 몸무게가 0이면 몸무게가 없다고 할 수 있음

	-카테고리 데이터[질적(quantitative) : 범주형(국가,성별]
		순서데이터(Ordinal)
			숫자로 순서를 표현한 데이터
			ex) 1등.2등,3등
		Nominal 데이터
			숲,도시,물 같이 이름으로 나타나는 척도
	
연속적 데이터
	-histogram : 데이터의 분포 정보
		Symmetric(대칭), 치우진, 단봉형, 양봉형 형태가 있음	
 		Positively skewed( 분포도의 봉이 왼쪽, 오른쪽이 뾰족한)
			ㄴ skewness의 계수 부호에 주의하자

	-정량적 측정
		Mean(평균) -> 극단값을 제외한 흐름을 파악
		Median(중앙값) -> 모든 관측값의 흐름을 파악
		Mode(최빈값) ->정량,정서 데이터 모두 사용,interval(간격)에 따라바뀜

	-극단값 처리
		에러라고 판정 -> 지움
		log나 제곱으로 극값 영향을 줄이기
		자료를 왜곡시키는 이상(극단)값을 분리함
		Median, IQR(Q3-Q1) 같은 Robust 통계사용

	-산포도(dispersion) 측정
	  -> 측정의 중간에서 얼마나 떨어졌거나 밀집되었는지 측정
		분산/표준편차
			모분산(N으로 나눔), 표본분산(잔차제곱의 합을 n-1로 나눔)
		범위
			최소,최대값의 차이 -> 극값에 영향을 크게 받음
					-> 분포 정도를 고려하지 않음
		분위수(Quantile)
			정렬된 전체 자료를 특정 개수로 나눌때 기준이 되는 수
		 1.p-quantile
			백분위수라고도 하며 P(확률) = p*100
				ex) 75%에 해당하는 분위수 = Q3
			
		  2.IQR (Q3-Q1)
			극값에 영향을 덜 받음

		  3. 비틀린 계수 (Coefficent of Skewness)
			-> 분포도의 모양을 설명함
			-> asymmetry(비대칭)을 측정함
				
	-> 이산적 데이터에 위의 통계기법을 사용하는건 의미가 없음

상관계수(Correlation Coefficient)
	-> 두 데이터 간의 관계성
	-> scatter plot(산점도)으로 시각적으로 점검할 수 있다

	-선형 상관계수(r : -1 ~ 1)
		r = Sxy/[sqrt(Sxx)*sqrt(Syy)]
		  Sxy(공분산) = (x데이터 잔차 * y데이터 잔차)/n-1의 합
		  Sxx = x데이터의 표본분산의 합
		  Syy
		-> 공분산을 각각의 표준 편차로의 곱으로 나눔
		-> r의 제곱을 표본결정계수라함
		0에 가까울 수록 선형상관관계가 없음
		-1은 반비례 1은 비례
			-> 수평,수직의 산점도는 표본상관계수(r)가 0임

공간데이터
	-> 지리데이터는 서로 연관이 있으며, 가까울수록 연관성이 높음
	-> 공간속성데이터는 위치,entity(실체, 개체,정보 단위)(area/region/ object)에 연관이 됨

	-특성
		샘플의 위치가 일정(레스터), 불규치적(scatter)일수 있음
		대부분의 공간데이터는 시간적인 속성이 있음
		공간이 가까울수록 연관성이 높음 -> auto-correlation(자기상관)

	-공간자기상관
		단일 변수의 위치에 따른 상관관계
		거리&방향에 따라 상관관계의 강도가 변함

	-공간교차상관
		서로 다른 변수간 위치에 따른 상관관계
		거리&방향에 따라 상관관계의 강도가 변함

공간데이터 종류
	-지리통계 데이터
		공간에 연속적인 속성을 갖음
		-> nominal, interval, ratio 데이터

	-범위(lattice: 격자) 데이터
		범위가 고정되어있는 데이터 ( 행정동)

	->지리통계데이터와 격자데이터가 항상 구분되지는 않음
	-> 위성영상처럼 지리통계데이터를 격자구조로 찍은 경우처러

	-포인트 패턴 데이터
		위치에 따른 사건이 기록되는경우
		ex) 나무,질병 발생, 범죄발생 위치

Univariate statistics vs Spatial pattern
  히스토그램, 1d 횡단 단일 통계는 공간패턴을 설명하기에는 부족함
	-> 공간 배치에 따라 속성값이 영향을 받는다

MAUP(Modifiable Area Unit Problem) 가변적 공간 단위 문제
  공간 스케일, 배치에 따라 통계 혹은 속성값의 변화
	
  Aggregation effect(배치로 인한 영향)(스케일)
	자료요약, downscaling(고해상도)처리 하면 선형상관계수,표준편차가 바뀜

  Zonation effect(띠의 모양(스키마)로 인한 영향)
	자료를 요약하는 기준에 따라(grid의 행,열) 선형상관계수,표준편차가 바뀜


3장. 공간 패턴 모델링

--일변량(Univariate) 공간 정의
      ㄴ 분석할 변수나 변량이 하나
	1. 시각화(위치기반 지도)
	2. h-scattergram -> 거리,방향에 따른 관계


  h-scattergram	
	h-scattergram을 통해 데이터간의 공간관계를 나타낼 수 있음
	1.scattergram
		같은 방향에서 다른 속성의 관계를 나타낸 점 그래프
	2.h-scattergram
		같은 속성에서 거리(h)와 방향에 따른 관계를 나타낸 점 그래프

	-> 관습에 따라 h벡터의 시작점(꼬리)를 z(u) 종점(머리)을 z(u+h)라 함
	-> 거리(lags)와 각도로 데이터를 그룹시키며, 이를 통해 h-scattergram이 충분한 표본을 갖음, 거리[h+-△h], 방향[Θ+-△Θ]

  1차원 h-scattergram
	x축을 tail(속성값) y축을 head(h만큼 떨어진 지점의 속성값)로 표현
	-> 두축이 거리라는 한 변수를 갖음으로 완변한 상관관계는 기울기가 45도인 이등분선에 위치할 것
	-> 설정한 distance에 따라 data pair 갯수가 달라진다
	    ex) 10 20 30 40 50 60 -> 거리 순서의 데이터의 속성값
		if distance =1 -> (10,20), (20,30), (30,40)으로 표현
	-> 거리가 멀어질수록 상관계수 떨어지고 거리가 멀수록 신뢰성 떨어짐

 2차원 h-scattergram
	벡터h에 따른 거리와 방향(방위각으로) 표현
	규칙적인 격자 구조에서 이동할 방향(Θ)을 고정시키고 거리(h)를 변화시킨다
	불규칙적인 공간데이터에서 거리와 거리별 허용오차, 방향허용오차, 밴드넓이를 규정한다
	  ->불규칙적인 경우 거리,방향 허용오차(완화)를 지정함으로써 해당되는 데이터를 지정할 수 있음 -> 주로 절반의 값을 허용오차로함
	  -> ex) h=10 이면 △h = +-5 , Θ=NE 45도이면 △Θ는 NE 22.5도 ~ 67.5도
		-> 각각의 h(10,20,30,40)별로 scattergram 작성됨
	  -> 하지만 거리가 멀어질 수록 범위가 점점 넓어짐 -> bandwith를 설정해 해결
	  -> bandwith를 10으로하면 그 이상의 범위는 포함안함

  공분산 함수(Covariance Function)
	https://blog.naver.com/PostView.naver?blogId=aservmz&logNo=222119112852&categoryNo=47&parentCategoryNo=46&viewDate=&currentPage=1&postListTopCurrentPage=1&from=thumbnailList&userTopListOpen=true&userTopListCount=5&userTopListManageOpen=false&userTopListCurrentPage=1  
   	-> 참고해서 복습
	-> 공분산 함수
	C(h) = z(u)*z(u+h)/N(h) - mt*mh
		ㄴ1번식		ㄴ2번식
	  ->N(h)는 Data pair의 갯수
	  -> 1번식 tail*head의 평균
	  -> 2번식 tail평균 * head 평균

   상관도(Correlogram)
	상관관계도와 유사
	p(h)(상관도) = C(h)/sqrt(tail분산*head분산)


4장 공간패턴 모델링

--세미베리오그램(Semivariogram)
비유사도 평균의 측정 -> 공분산 함수와 반대되는 개념 -> 그래프 모양도 서로 대칭임
  -> e(h) = (z(u)-z(u+h))^2/2 -> 잔차 제곱의 절반
  -> e(h)값의 모음을 Semivariogram cloud라 함
  -> 거리기반 속성간의 비상관성을 측정할 수 있음
  -> 모든 데이터 짝을 사용하면 해석하기 어려워, 비슷한 거리의 샘플끼리 묶어 비교하기

--세미베리오그램 정의
    -> 잔차 제곱 절반의 평균
    -> r(h) = E[ {z(u)-z(u+h)}^2 ] / 2


--Sample 베리오그램
  모든 데이터를 이용하여 Varigram cloud를 만들면 통계적 해석이 어렵기 때문에 h간격으로 묶어 베리오그램을 진행시킴
  -> 공간분산의 크기를 의미하기도 함
  -> 기준점에서 h값을 변화시키며 각각의 lag와 방위각에 해당하는 값의 세미베리오그램을 계산함
  -> 기준점을 모든 점으로 바꿔가면서 평균을 계산하여 해당 h의 r(h)값을 도출


  3개의 파리미터
  1. Nugget effect -> r(0)일때의 값 -> 0인경우도 있음
	h=0이라면 r(h)값도 0이여야 이지만, 잡음+오류로 인해 아닌경우도 있음
	특정 h기준으로 Sample을 추출했을때 기준 h보다 작은 경우 상관관계를 고려할 수없게 된다
	즉,에러 + micro-structure의 합을 뜻함
  2. Sill -> 상관성이 사라지는 h값의 r(h)값
  3. Range(상관거리) -> 상관성이 사라지는 지점의 h값


--다른관점의 베리오그램
  Directional variogram(방향성)
	Sample 베리오그램과 더불어 방위각도 포함된 베리오그램
	+y축(북쪽)기준 -22.5~22.5, 22.5~72.5, 72.5~115.5, 115.5~157.5
		-> 이후 각도는 반대 방위각과 동일 
  Omnidirectional(전 방향성)
	완화각도를 0~90도로 설정함으로써 모든 방향에서 데이터 pair을 만듬
	완화각도가 90도이하면 다 omnidircectional이라 함
	-> 공분산함수와 semi베리오그램이 이에 해당됨

-- 실습
20년 5월 오존 측정값으로 진행

n + (s-n) * (1 - exp(-k * x/r)); n=n; s=s; r=r; k=3
n + (s-n) * (1 - exp(-k * x/r)); n=n; s=s; r=1.22732; k=3
	2.511

n + (s-n) * (1 - exp(-(x/r)^k)); n=n; s=s; r=r; k=1
r=3.1

n + (a-n) * (1 - exp(-(x/b)^1)); n=n; a=a; b=b


 n+ (s-n) * (1 - exp(-k * x/r)) + (a-n) * (1 - exp(-(x/b)^t)); n=n;r=1.22732 s=s; k=3; a=a; b=3.1; t=1;

n + (s-n) * (1 - exp(-k * x/r)); n=n; s=s; r=1.22732; k=3

-> 표본에 맞게 보다는, 목적지향성(근거리에 대한 상관성의 정확도) 더 중요함

베리오그램 모델링에 사용되는 함수
  Spherical Mode; : 값이 선형적으로,천천히 증가하는 형태
  Exponential Model :  값이 급격하게 증가하는 형태 -> 유효거리는 Sill의 95%값
  Gaussian Model : 값의 증가폭이 작았다가 점점 증가하는형태
  Power Model : Sill,range가 존재하지 않으며 -> 비유사도 꾸준하게 증가할경우 사용(Unbounded Variogram)


5장, 6장, 7장 공간예측(1)

--학습목표
  1. 거리 역비례 가중치를 이용해 균일하지 않은 속성값을 예측하는 방법
  2. 크리깅의 가중치값을 결정하는데 고려할 사항
  3. 크리깅 시스템을 이해하고 기억하기
  4. 베리오그램이 크리깅에 사용되는 방법
  5. 크리깅을 통해 샘플이 없는 위치의 속성값을 예측할 수 있는가?

--공간예측방법
  1. 공간패턴 파악
  2. 공간패턴에 맞는 모델링 진행
  3. 공간패턴 모델링을 바탕으로 크리깅

--예측방법론
  -> 단일 추정치 값을 반환함
  -> 에러값은 무시할 수 있다
  -> 방법론
	1. Thiessen ploygons
	2. Splines
	3. Inverse distance weighting
	4. 기타 등등 방법은 많음


1. Thiessen polygons
  가장 가까운 값을 추정치 값으로 선정
  ->관측된 데이터의 범위 영향력을 나타냄

2. Inverse distance weighting
  이웃의 데이터를 선형으로 참고한 추정치
   -> 수식은 따로 메모함
   -> w는 주로 2로 진행됨


--Kriging
  주변 속성값을 선형으로 고려해 예측
  최소제곱법으로 보간을 진행함
  -> 추정값 - m(u) = [가중치*(샘플값- m(ua))]의 합  :: m(u) -> Local mean
  

  크리깅의 가중치 구하는 과정에서 가정 2개
  1. 추정값은 편향되지 않음
  2. 추정분산은 최소임

  크리깅 수식의 m(u)값에 따라 3가지 크리깅 방법이 있음
  Simple Kriging(SK)
  - 연구지역의 평균(m(u))은 일정하고 값이 알려짐
  - 추정치값이 샘플값과 멀어지면 m(u)에 가까워짐
	즉, 평균에 대한 가중치가 커짐
  -> 가중치 구하는법 : -> 최소제곱법(행렬)
	[샘플간의 공분산][가중치] = [베리오그램과 샘플의 공분산]

  -> 추정값 = (가중치*샘플값)의 합-(1-가중치의합)*m
  -> SK분산 = C(0) - [가중치(SK)* 베리오그램과 샘플의 공분산]의 합

  Ordinary Kriging(OK)
  - 연구지역의 평균(m(u)은 알려져있지 않지만 탐색영역의 평균W(u)은 알려져있음
  - 탐색창을 설정함으로써 크리깅 수식의 local mean을 도출함
  - m(u)를 선형 추정법을 통해 크리깅 가중치의 합이 1되게함
  - 가중치는 오류분산을 비편향되게 제한함으로써 최소가 되게 결정됨
	     ㄴ 라그랑지를 통해 오류분산을 최소화함
		ㄴ 라그랑지 파라미터 2υ(u), 가중치(OK)

  -> 가중치 구하는법 : -> 최소제곱법(행렬)
       1. [샘플간의 공분산][가중치] + 라그랑지 파라미터 = 
				   [추정치의 베리오그램과의 샘플 공분산]
       2. 가중치(OK)의 합은 =1

   -> OK분산 = C(0) - [가중치(OK)* 베리오그램과 샘플의 공분산]의 합 - υ(u).

  Kriging with as Trend(KT) ~ Universal Kriging
  -  연구지역 평균은 모르며, 좌표에 따른 선형함수로 모델링 함


SK vs OK
  -> OK가 더 선호됨 -> 연구지역의 지식이 필요없음으로 (local mean 같은거)
  -> 탐색창을 통해 local mean을 측정해 SK 수식에 적용하는 방법도 있음(SKLM)
  -> 샘플과의 데이터가 멀어질 수록 SK는 알려진 local mean에 가까워지려고하지만, OK는 해당 탐색창의 mean에 가까워지려함
  -> 즉, SK는 일정하고싶어하고, OK는 각 지역에 맞게 보간됨
	그러다보니 OK 추정치 분산은 상대적으로 커지려는 경향이 있음
	SK는 항상 mean에 따라가지만, OK 지역 mean에 따라가기 때문에

크리깅 가중치
  크리깅 가중치는 베리오그램의 모형에 영향받음(nugget,corrleation range, 이방성(데이터를 보는 방향), 반면에 sill, 곱해지는 공분산 행렬은 영향이 없음